{% extends "myapp/home.html" %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .pagination {
            display: inline-block;
            margin: 20px 0;
          }
          
          .pagination li {
            display: inline;
            margin-right: 5px;
            padding: 5px 10px;
            border: 1px solid #ccc;
            background-color: #fff;
            color: #333;
            cursor: pointer;
          }
          
          .pagination li.active {
            background-color: #007bff;
            color: #fff;
          }
          
          .pagination li:hover {
            background-color: #ccc;
          }
          
        body {
            background-color: #eee;
        }
        
        table th, table td {
            text-align: center;
        }
        
        table tr:nth-child(even) {
            background-color: #BEF2F5;
        }
        
        .pagination li:hover {
            cursor: pointer;
        }
        
        table tbody tr {
            display: none;
        }
        /* Style du tableau */
        .table {
        width: 100%;
        margin-bottom: 1rem;
        color: #333;
        background-color: #fff;
        border-collapse: collapse;
        border: 1px solid #ccc;
        }

        /* Style de l'en-tête du tableau */
        .table thead th {
        background-color: #007bff;
        color: #fff;
        text-align: center;
        padding: 10px;
        }

        /* Style des lignes impaires du tableau */
        .table tbody tr:nth-child(odd) {
        background-color: #f2f2f2;
        }

        /* Style des cellules du tableau */
        .table td {
        text-align: center;
        padding: 8px;
        }

        /* Style au survol de la ligne du tableau */
        .table tbody tr:hover {
        background-color: #e0e0e0;
        }

    </style>
</head>
<body>
<style>
    body{

        background-color: #eee; 
    }
    
    table th , table td{
        text-align: center;
    }
    
    table tr:nth-child(even){
        background-color: #BEF2F5
    }
    
    .pagination li:hover{
        cursor: pointer;
    }
            table tbody tr {
                display: none;
            }
</style>
<div class="container">
    <h2>Select Number Of Rows</h2>
            <div class="form-group"> 	<!--		Show Numbers Of Rows 		-->
                 <select class  ="form-control" name="state" id="maxRows">
                     <option value="5000">Show ALL Rows</option>
                     <option value="5">5</option>
                     <option value="10">10</option>
                     <option value="15">15</option>
                     <option value="20">20</option>
                     <option value="50">50</option>
                     <option value="70">70</option>
                     <option value="100">100</option>
                    </select> 
              </div>   
              <table class="table table-striped table-class" id="table-id">
                <thead>
                    <tr>
                        <th>Nom de la société</th>
                        <th>Secteur</th>
                        <th>Emails</th>
                        <th>Numéro 1</th>
                        <th>Numéro 2</th>
                        <th>Numéro 3</th>
                        <th>Téléphone fixe</th>
                        <th>Adresse</th>
                        <th>Prénom du décideur</th>
                        <th>Nom du décideur</th>
                        <th>Email du décideur</th>
                    </tr>
                </thead>
                <tbody>
                    {% for societe in societes %}
                    <tr>
                        <td>{{ societe.nom }}</td>
                        <td>{{ societe.secteur }}</td>
                        <td>{{ societe.emails }}</td>
                        <td>{{ societe.numero1 }}</td>
                        <td>{{ societe.numero2 }}</td>
                        <td>{{ societe.numero3 }}</td>
                        <td>{{ societe.fixe }}</td>
                        <td>
                            <ul>
                                {% for adresse in societe.adresses.all %}
                                <li>{{ adresse.adresse }}, {{ adresse.ville }}</li>
                                {% endfor %}
                            </ul>
                        </td>
                        {% for decideur in societe.decideurs.all %}
                        <td>{{ decideur.prenom }}</td>
                        <td>{{ decideur.nom }}</td>
                        <td>{{ decideur.email }}</td>
                        {% empty %}
                        <td></td>
                        <td></td>
                        <td></td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>     
<div class="pagination-container">
    <nav>
        <ul class="pagination">
            <li data-page="prev">
                <span><</span>
            </li>
            <!-- JavaScript ajoutera les numéros de page ici -->
            <li data-page="next" id="prev">
                <span>></span>
            </li>
        </ul>
    </nav>
</div>   
</body>
</html>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(document).ready(function() {
  getPagination('#table-id');

  function getPagination(table) {
    var lastPage = 1;

    $('#maxRows').on('change', function(evt) {
      lastPage = 1;
      $('.pagination').find('li').slice(1, -1).remove();
      var trnum = 0;
      var maxRows = parseInt($(this).val());

      if (maxRows == 5000) {
        $('.pagination').hide();
      } else {
        $('.pagination').show();
      }

      var totalRows = $(table + ' tbody tr').length;
      $(table + ' tr:gt(0)').each(function() {
        trnum++;
        if (trnum > maxRows) {
          $(this).hide();
        }
        if (trnum <= maxRows) {
          $(this).show();
        }
      });

      if (totalRows > maxRows) {
        var pagenum = Math.ceil(totalRows / maxRows);
        for (var i = 1; i <= pagenum; ) {
          $('.pagination #prev').before(
            '<li data-page="' +
              i +
              '">\
              <span>' +
              i++ +
              '<span class="sr-only"></span></span>\
            </li>'
          ).show();
        }
      }

      $('.pagination [data-page="1"]').addClass('active');
      $('.pagination li').on('click', function(evt) {
        evt.stopImmediatePropagation();
        evt.preventDefault();
        var pageNum = $(this).attr('data-page');
        var maxRows = parseInt($('#maxRows').val());

        if (pageNum == 'prev') {
          if (lastPage == 1) {
            return;
          }
          pageNum = --lastPage;
        }
        if (pageNum == 'next') {
          if (lastPage == $('.pagination li').length - 2) {
            return;
          }
          pageNum = ++lastPage;
        }

        lastPage = pageNum;
        var trIndex = 0;
        $('.pagination li').removeClass('active');
        $('.pagination [data-page="' + lastPage + '"]').addClass('active');
        limitPagging();
        $(table + ' tr:gt(0)').each(function() {
          trIndex++;
          if (
            trIndex > maxRows * pageNum ||
            trIndex <= maxRows * pageNum - maxRows
          ) {
            $(this).hide();
          } else {
            $(this).show();
          }
        });
      });
      limitPagging();
    }).val(5).change();
  }

  function limitPagging() {
    if ($('.pagination li').length > 7) {
      if ($('.pagination li.active').attr('data-page') <= 3) {
        $('.pagination li:gt(5)').hide();
        $('.pagination li:lt(5)').show();
        $('.pagination [data-page="next"]').show();
      }
      if ($('.pagination li.active').attr('data-page') > 3) {
        $('.pagination li:gt(0)').hide();
        $('.pagination [data-page="next"]').show();
        for (let i = parseInt($('.pagination li.active').attr('data-page')) - 2; i <= parseInt($('.pagination li.active').attr('data-page')) + 2; i++) {
          $('.pagination [data-page="' + i + '"]').show();
        }
      }
    }
  }

  // Just to append ID numbers for each row
  $('table tr:eq(0)').prepend('<th> ID </th>');
  var id = 0;
  $('table tr:gt(0)').each(function() {
    id++;
    $(this).prepend('<td>' + id + '</td>');
  });
});
</script>
{% endblock %}
